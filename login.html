<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="css/ZUI.min.css">
    <link rel="stylesheet" href="plugins/ionicons/css/ionicons.min.css">
    <link rel="stylesheet" href="plugins/font-awesome/css/font-awesome.min.css">
    <title>移动护理后台 | 病区信息管理</title>
    <!-- [if lt IE 9]
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    [endif] -->
</head>
<body ng-app="ydhlApp" class="hold-transition skin-blue sidebar-mini" onload="">
<div id="main" style="width:100%;margin-top:10%;">
    <form id="loginForms" action="../login/loginIn" method="post"  target="_self">
        <div id="loginDiv">
            <table class="table" style="text-align:center;width:100%;height:100%">
                <tr style="height:50%;">
                </tr>
                <tr>
                    <td style="font-size:20px;height:30px;font-weight:bolder;">移动护理管理后台</td>
                </tr>
                <tr>
                    <div style="margin:0 auto;">
                        <td style="display: block;margin-top:10px;">用户名<input class="textinput" id="sloginName" type="text" placeholder="请输入用户名" name="loginName" style="margin-left:2px;"/></td>
                    </div>
                </tr>
                <tr>
                    <div style="margin:0 auto;">
                        <td style="display: block;margin-top:5px;">密&nbsp;&nbsp;码<input  class="textinput" id="sloginPwd" type="password" placeholder="请输入密码" name="loginPwd" style="margin-left:2px;"/></td>
                    </div>
                </tr>
                <tr>
                    <td>
                        <p>
                            <input class="check"  id="saveAdminId" type="checkbox"  value="记住账号"/>
                            <span>记住账号</span>
                            <input class="check" id="saveCookie" type="checkbox"  value="记住密码"/>
                            <span>记住密码</span>
                        </p>
                    </td>
                </tr>
                <tr>
                    <td>
                        <input id="loginSubmit"  type="button" value="登  录" class="loginBtn" />
                    </td>
                </tr>
            </table>
        </div>
    </form>
</div>
</div><!--main-->
</body>
<script src="js/lib/jQuery-2.1.4.min.js"></script>
<script src="js/common.js"></script>
<script type="text/javascript">
	function judgeLogin(){
		if($('#sloginName').val()==''){
			$('#sloginName').focus();
			alert('请输入用户名！');
			return false;
		}
		if($('#sloginPwd').val()==''){
			$('#sloginPwd').focus();
			alert('请输入密码！');
			return false;
		}
		return true;
	}
    function doLogin(){
        var sloginName=$("#sloginName").val();
        var sloginPwd=$("#sloginPwd").val();
        if(judgeLogin()){
            $.post(APIurl+"/login/loginIn",{loginName:sloginName,loginPwd:sloginPwd},function(data){
                if(data==1){
                    if($("#saveCookie").prop("checked")){
                        //记住密码被选中
                        setCookie("sloginName",$("#sloginName").val(),24);
                        setCookie("sloginPwd",$("#sloginPwd").val(),24);
                    }else if($("#saveAdminId").prop("checked")){
                        //记住账号被选中
                        setCookie("sloginName",$("#sloginName").val(),24);
                        deleteCookie("sloginPwd");
                    }else{
                        //两者都没有被选择
                        deleteCookie("sloginName");
                        deleteCookie("sloginPwd");
                    }
                    location.href=APIurl+"/rfid.html";
                    return;
                }
                    alert(data);
            });
        }
    }

    //新建cookie。
    //hours为空字符串时,cookie的生存期至浏览器会话结束。hours为数字0时,建立的是一个失效的cookie,这个cookie会覆盖已经建立过的同名、同path的cookie（如果这个cookie存在）。
    function setCookie(name,value,hours){
        var name = escape(name);
        var value = escape(value);
        var expires = new Date();
        expires.setTime(expires.getTime() + hours*3600000);
        var path = ";path=" + path;
        _expires = (typeof hours) == "string" ? "" : ";expires=" + expires.toUTCString();
        document.cookie = name + "=" + value + _expires + path;
    }

    //获取cookie值
    function getCookieValue(name){
        var name = escape(name);
        //读cookie属性，这将返回文档的所有cookie
        var allCookies = document.cookie;
        //查找名为name的cookie的开始位置
        name += "=";
        var pos = allCookies.indexOf(name);
        //如果找到了具有该名字的cookie，那么提取并使用它的值
        if (pos != -1){
            //如果pos值为-1则说明搜索"version="失败
            var start = pos + name.length;
            //从cookie值开始的位置起搜索第一个";"的位置,即cookie值结尾的位置
            var end = allCookies.indexOf(";",start);
            //如果end值为-1说明cookie列表里只有一个cookie
            if (end == -1) end = allCookies.length;
            //提取cookie的值
            var value = allCookies.substring(start,end);
            //对它解码
            return unescape(value);
        }
        //搜索失败，返回空字符串
        else return "";
    }

    //删除cookie
    function deleteCookie(name){
        var name = escape(name);
        var expires = new Date(0);
        var path = ";path=" + path;
        document.cookie = name + "="+ ";expires=" + expires.toUTCString() + path;
    }


    $(function(){
        var sloginName = getCookieValue("sloginName");
        var sloginPwd = getCookieValue("sloginPwd");
        $("#sloginName").val(sloginName);
        $("#sloginPwd").val(sloginPwd);
        if(sloginName!=null && sloginName!=''){
            $("#saveAdminId").prop("checked",true);
        }
        if(sloginPwd!=null && sloginPwd!=''){
            $("#saveCookie").prop("checked",true);
        }
        $(document).keydown(function(event){
            if(event.keyCode==13){
                doLogin();
            }
        });

        $("#loginSubmit").click(function(){
               doLogin();
        });
    });
</script>
</body>
</html>