<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="x-ua-compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>移动护理后台 | 病区信息管理</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/login.css">
	<link rel="stylesheet" href="css/ZUI.min.css">
    <link rel="stylesheet" href="plugins/ionicons/css/ionicons.min.css">
    <link rel="stylesheet" href="plugins/font-awesome/css/font-awesome.min.css">
</head>
<body>
<div class="bg" alt=""></div>
<nav class="navbar navbar-inverse">
    <div class="navbar-header">
        <div class="login_img"></div>
    </div>
</nav>
<div class="container-wrapper">
    <div class="container">
        <div class="row" style="position: relative">
            <div class="col-md-8" style="height: 300px; overflow: hidden;">
                <img class="hospital_img" src="images/p_sytz.jpg">
            </div>
            <div class="col-md-4 login-div" style="position:absolute;">
                <span class="form-head">| 登录系统</span>
                <form id="login-form" style="margin-bottom: 10px;">
                    <br>
                    <input type="text" class="form-control" id="sloginName" name="username" placeholder="请输入手机号或工号">
                    <br>
                    <input type="password" class="form-control" id="sloginPwd" name="password" placeholder="请输入密码">
                    <p class="msg-alert"></p>
                    <!--
						<input type="button" class="btn btn-primary form-control login-btn" value="登&nbsp;录">
					-->
					<input id="loginSubmit" class="btn btn-primary form-control login-btn"  type="button" value="登  录" class="loginBtn" />
                </form>
                <div class="login-auto">
                    <input type="checkbox" title="记住账号" id="saveAdminId" checked="checked"><span>记住账号</span>
                </div>
                <div class="remember-pass">
                    <input type="checkbox" title="记住密码" id="saveCookie" checked="checked"><span>记住密码</span>
                </div>
            </div>
        </div>
    </div>
</div>
<br>
<div class="container">
    <div class="row">
        <div class="col-md-12" style="text-align: center;">
            <div class="qr-code">
                <img src="images/qr_code.jpg" alt="二维码">
            </div>
            <div class="download">
            	<span style="margin-top: 10px; display: block;">扫描二维码下载APP</span>
                <!--<div class="ios-app">
                    <img src="images/pc_ios.png" alt="iosLOGO" style=" width:18px; margin-top:-4px;">&nbsp;&nbsp;
                    <span>iPhone&nbsp;&nbsp;下载</span>
                </div>-->
                <div class="android-app">
                    <img src="images/pc_Android.jpg" alt="iosLOGO" style=" width:18px; margin-top:-4px;">&nbsp;&nbsp;
                    <span>Android&nbsp;&nbsp;下载</span>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="js/lib/jQuery-2.1.4.min.js"></script>
<script src="js/common.js"></script>
<script src="js/bootstrap.min.js"></script>
<script type="text/javascript">
	function judgeLogin(){
		if($('#sloginName').val()==''){
			$('#sloginName').focus();
			alert('请输入用户名！');
			return false;
		}
		if($('#sloginPwd').val()==''){
			$('#sloginPwd').focus();
			alert('请输入密码！');
			return false;
		}
		return true;
	}
    function doLogin(){
        var sloginName=$("#sloginName").val();
        var sloginPwd=$("#sloginPwd").val();
        if(judgeLogin()){
            $.post(APIurl+"/login/loginIn",{loginName:sloginName,loginPwd:sloginPwd},function(data){
                if(data==1){
                    if($("#saveCookie").prop("checked")){
                        //记住密码被选中
                        setCookie("sloginName",$("#sloginName").val(),24);
                        setCookie("sloginPwd",$("#sloginPwd").val(),24);
                    }else if($("#saveAdminId").prop("checked")){
                        //记住账号被选中
                        setCookie("sloginName",$("#sloginName").val(),24);
                        deleteCookie("sloginPwd");
                    }else{
                        //两者都没有被选择
                        deleteCookie("sloginName");
                        deleteCookie("sloginPwd");
                    }
                    location.href=APIurl+"/rfid.html";
                    return;
                }
                    alert(data);
            });
        }
    }

    //新建cookie。
    //hours为空字符串时,cookie的生存期至浏览器会话结束。hours为数字0时,建立的是一个失效的cookie,这个cookie会覆盖已经建立过的同名、同path的cookie（如果这个cookie存在）。
    function setCookie(name,value,hours){
        var name = escape(name);
        var value = escape(value);
        var expires = new Date();
        expires.setTime(expires.getTime() + hours*3600000);
        var path = ";path=" + path;
        _expires = (typeof hours) == "string" ? "" : ";expires=" + expires.toUTCString();
        document.cookie = name + "=" + value + _expires + path;
    }

    //获取cookie值
    function getCookieValue(name){
        var name = escape(name);
        //读cookie属性，这将返回文档的所有cookie
        var allCookies = document.cookie;
        //查找名为name的cookie的开始位置
        name += "=";
        var pos = allCookies.indexOf(name);
        //如果找到了具有该名字的cookie，那么提取并使用它的值
        if (pos != -1){
            //如果pos值为-1则说明搜索"version="失败
            var start = pos + name.length;
            //从cookie值开始的位置起搜索第一个";"的位置,即cookie值结尾的位置
            var end = allCookies.indexOf(";",start);
            //如果end值为-1说明cookie列表里只有一个cookie
            if (end == -1) end = allCookies.length;
            //提取cookie的值
            var value = allCookies.substring(start,end);
            //对它解码
            return unescape(value);
        }
        //搜索失败，返回空字符串
        else return "";
    }

    //删除cookie
    function deleteCookie(name){
        var name = escape(name);
        var expires = new Date(0);
        var path = ";path=" + path;
        document.cookie = name + "="+ ";expires=" + expires.toUTCString() + path;
    }


    $(function(){
        var sloginName = getCookieValue("sloginName");
        var sloginPwd = getCookieValue("sloginPwd");
        $("#sloginName").val(sloginName);
        $("#sloginPwd").val(sloginPwd);
        if(sloginName!=null && sloginName!=''){
            $("#saveAdminId").prop("checked",true);
        }
        if(sloginPwd!=null && sloginPwd!=''){
            $("#saveCookie").prop("checked",true);
        }
        $(document).keydown(function(event){
            if(event.keyCode==13){
                doLogin();
            }
        });

        $("#loginSubmit").click(function(){
               doLogin();
        });
    });
</script>
</body>
</html>